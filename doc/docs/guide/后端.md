# 功能模块--后端

后端使用Python社区成熟的Web框架Django，除了强大的后台系统外，还提供了一套完善API。

## 数据库
本系统将元器件信息存储在数据库中，管理系统下主要有`Type`、`Attr`、`Component`、`Record`四张表，主要业务就是对这四个表进行增删改查。

这是**最为重要**的部分

### 存储结构
围绕`Component`，`Record`与`Component`，负责出入库记录，`Type`和`Attr`则与`Component`是一对多的关系，辅助`Component`的筛选。

主要关注的是交易（在库）金额和交易（在库）数量。

**元器件Component**
| 字段     | 说明             | 限制                           |
| -------- | ---------------- | ------------------------------ |
| id       | 编号             | 唯一，自增，无需指定           |
| name     | 组件名称         | 唯一，不超过128个字符          |
| types    | 类型，可关联多个 |                                |
| attrs    | 属性，可关联多个 |                                |
| num      | 在库数量         | 由Record自动更新，无需手动修改 |
| money    | 在库价值金额     | 由Record自动更新，无需手动修改 |
| min\_num | 库存警告线       |                                |

**类型Type和属性Attr**
| 字段 | 说明 | 限制                 |
| ---- | ---- | -------------------- |
| id   | 编号 | 唯一，自增，无需指定 |
| name | 名称 | 唯一，不超过64个字符 |

**记录Record**
| 字段      | 说明                         | 限制                 |
| --------- | ---------------------------- | -------------------- |
| id        | 编号                         | 唯一，自增，无需指定 |
| operation | 操作，入库（1）或出库（\-1） | 整数，\-1或1         |
| component | 关联组件                     | 只能关联一个         |
| num       | 交易数量                     |                      |
| money     | 价值金额                     | 正数                 |
| time      | 交易时间                     | 至少精确到秒         |


### 兼容主流数据库
得益于Django框架强大的ORM模块，可以很好的切换不同的数据库，小至Sqlite3，大至MySQL，PostgreSQL，可根据自己的需求选择适合生产要求的数据库。

## 统计

### 交易记录
基于存储在数据库的`Record`，可查询每年/月/天的出入库的聚合（汇总）情况，同时还可以选定。

### 组件信息
正确添加的记录（而不是绕过系统去修改数据库）可以增减到组件信息上，查询每个组件的在库信息是十分容易的事情。

后端可以在`/Admin/main/`中看到。

## Admin
```
/admin/
```
Django自带了功能强大的后台系统，这里超级管理可进行全局管理，而无需运行Python命令或直接操作数据库。

这一后台系统也可以完成许多基础查询需求。

## RESTful API
```
/api/
```
后端系统基于`Django REST Framework`提供了RESTful API，便用使用者二次开发，也就是说交互部分、显示部分，完全可以不使用自带前端，而自己进行开发，二次开发者可以基于API开发PC应用或移动软件。


## 用户系统
提供了较为完善的用户系统，包括用户分级、分组，权限系统，邮箱验证，第三方登录，基于`JWT`认证，便于前后端分离的开发。

### 权限机制
完善的权限机制，系统默认采取了严格的权限策略：无论读写都需要管理员权限，也因此后端接口不便在浏览器直接访问测试。

### 第三方登录
默认提供了Github的第三方登录，OAuth2.0的授权流程十分相似，可参考Github流程接入国内微信、新浪微博等主流平台，在默认的前端系统中没有使用第三方登录

### 邮箱认证
提供了邮箱认证功能，默认不开启，需要提供邮箱服务器，并开启Celery、Redis服务（防止阻塞，提升体验）。

## 文档
尝试提供完善的文档，本文档基于`VuePress`构建，简介美观。
